<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Home — M/s Onkarnath Agrawal Sarraf (Bachcha Sarraf)</title>
  <link rel="icon" type="image/x-icon" href="assets/img/logo.png">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Fine jewellery — gold, diamond, silver.">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="assets/css/styles.css" />
</head>

<body class="bg-white text-slate-900">

<!-- Header -->
<header class="sticky top-0 z-40 bg-white/90 backdrop-blur border-b">
  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
    <a href="index.html" class="flex items-center gap-3 text-2xl font-serif text-yellow-800 tracking-wide">
      <img src="assets/img/logo.png" alt="Brand Logo" class="object-contain bg-white rounded-md shadow-md border border-yellow-700 p-1 max-h-24">
      <span class="font-semibold">M/s Onkarnath Agrawal Sarraf (Bachcha Sarraf)</span>
    </a>
    <nav class="hidden md:flex gap-6 text-sm">
      <a href="catalog.html">Catalog</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
    </nav>
  </div>
</header>

<!-- RATES SECTION -->
<section class="border-t border-b bg-gradient-to-r from-yellow-50 via-white to-yellow-50 backdrop-blur">
  <div class="max-w-6xl mx-auto px-4 py-12 md:py-16 min-h-[50vh]">

    <div class="text-center mb-10">
      <h2 class="text-3xl md:text-5xl font-semibold leading-tight">Today’s Extended Gold & Silver Rates</h2>
      <p class="mt-4 text-slate-600 text-base md:text-lg">
        Bank, Cash, Jewellery & MCX indicative prices — auto-updated from MCX feed.
      </p>
      <div id="rates-updated" class="mt-3 text-sm text-slate-500"></div>
    </div>

    <!-- Rate cards -->
    <div id="extended-rates" class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5"></div>

    <div class="text-xs text-slate-500 text-center mt-6">
      *Gold values shown for <strong>10 g</strong>. Silver values shown for <strong>1 kg</strong>.
    </div>
  </div>
</section>

<!-- Hero -->
<section class="max-w-6xl mx-auto px-4 py-10 grid md:grid-cols-2 gap-8 items-center">
  <div>
    <h1 class="text-3xl md:text-5xl font-semibold leading-tight">Elegant Gold & Diamond Jewellery</h1>
    <p class="mt-4 text-slate-600">Handcrafted designs. Hallmarked purity. Transparent pricing linked to MCX rates.</p>
    <div class="mt-6 flex gap-3">
      <a href="catalog.html" class="px-5 py-3 rounded-xl bg-black text-white">Shop Catalog</a>
      <a href="contact.html" class="px-5 py-3 rounded-xl border">Book a Visit</a>
    </div>
  </div>

  <img src="assets/img/hero.jpg" class="rounded-2xl w-full object-cover" alt="Hero">
</section>

<!-- New Arrivals -->
<section class="max-w-6xl mx-auto px-4 py-10">
  <h2 class="text-xl font-semibold mb-4">New Arrivals</h2>
  <div id="featured" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
  <div id="featured-empty" class="hidden text-center text-slate-500 py-8">No items to show.</div>
</section>

<!-- Scripts -->
<script>
  // CSV Parser
  function parseCSV(text) {
    const rows = [];
    let i = 0, cur = '', row = [], inQuotes = false;
    while (i < text.length) {
      const c = text[i];
      if (c === '"') {
        if (inQuotes && text[i+1] === '"') { cur += '"'; i++; }
        else inQuotes = !inQuotes;
      } else if (c === ',' && !inQuotes) {
        row.push(cur); cur = '';
      } else if ((c === '\n' || c === '\r') && !inQuotes) {
        if (cur !== '' || row.length) { row.push(cur); rows.push(row); cur = ''; row = []; }
      } else cur += c;
      i++;
    }
    if (cur !== '' || row.length) { row.push(cur); rows.push(row); }
    return rows;
  }

  async function loadCSV(url){
    const t = await (await fetch(url, {cache:'no-cache'})).text();
    const parsed = parseCSV(t.trim());
    const head = parsed[0].map(h=>h.trim());
    return parsed.slice(1)
      .filter(r => r.some(cell => (cell||'').trim() !== ''))
      .map(r => Object.fromEntries(head.map((h,i)=>[h, (r[i]||'').trim()])));
  }

  // Helper INR formatting
  function fmtINR(n){
    return n == null || Number.isNaN(Number(n)) ? '–'
      : '₹' + Number(n).toLocaleString('en-IN');
  }

  // Gold 10g, Silver 1kg pretty units
  function prettyUnit(u){
    if (!u) return '';
    if (u.trim() === "1000 g") return "1 kg";
    return u;
  }

  // Put GOLD MAX and SILVER MAX first
  function sortWithMaxFirst(items){
    const goldMax = items.filter(i => /GOLD\s*MAX/i.test(i.label));
    const silverMax = items.filter(i => /SILVER\s*MAX/i.test(i.label));
    const others = items.filter(i => !/MAX/i.test(i.label));
    return [...goldMax, ...silverMax, ...others];
  }

  // Load RATES.JSON
  (async () => {
    const grid = document.getElementById('extended-rates');
    const updatedEl = document.getElementById('rates-updated');

    try {
      const d = await fetch("data/rates.json", {cache:"no-cache"}).then(r => r.json());

      updatedEl.textContent = d.updated ? `Updated ${d.updated} — Source: ${d.source}` : '';

      if (Array.isArray(d.items)) {
        const ordered = sortWithMaxFirst(d.items);

        grid.innerHTML = ordered.map(item => {
          const isMax = /MAX/i.test(item.label || "");
          const cardClass = isMax
            ? "rounded-2xl border-2 border-yellow-400 shadow-xl bg-yellow-50 p-5"
            : "rounded-2xl border p-5 bg-white/80 hover:shadow-lg transition";

          return `
            <div class="${cardClass}">
              <div class="text-xs uppercase tracking-wide text-slate-500 mb-1">${item.label}</div>
              <div class="text-2xl md:text-3xl font-bold ${isMax ? 'text-yellow-800':'text-slate-800'}">
                ${fmtINR(item.buy)}
              </div>
              <div class="text-sm text-slate-600 mt-1">Sell ${fmtINR(item.sell)}</div>
              <div class="text-xs text-slate-400 mt-2">${prettyUnit(item.unit)}</div>
            </div>
          `;
        }).join('');
      }

    } catch (e) {
      console.error(e);
      grid.innerHTML = `<div class="text-center text-slate-500">Failed to load rates.</div>`;
      updatedEl.textContent = "Rates unavailable";
    }
  })();
</script>

</body>
</html>
