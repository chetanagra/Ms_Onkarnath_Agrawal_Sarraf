<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Home — M/s Onkarnath Agrawal Sarraf (Bachcha Sarraf )</title>
  <link rel="icon" type="image/x-icon" href="assets/img/logo.png">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Fine jewellery — gold, diamond, silver.">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="assets/css/styles.css" />
  <style>
    /* Extra styles for MAX cards */
    .max-card {
      border-width: 2px;
      border-color: #f6b91f; /* yellow */
      background: linear-gradient(180deg, rgba(255,250,235,0.9), rgba(255,247,230,0.7));
      box-shadow: 0 10px 30px rgba(246,185,31,0.12), 0 2px 8px rgba(0,0,0,0.04);
      transform: translateY(-2px);
    }
    .max-badge {
      position: absolute;
      right: 0.5rem;
      top: 0.5rem;
      background: #f59e0b;
      color: white;
      font-weight: 600;
      font-size: 0.675rem;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      box-shadow: 0 6px 18px rgba(245,158,11,0.12);
    }
    .max-price {
      font-size: 2.125rem; /* bigger */
      line-height: 1;
    }
    /* Slightly larger grid for top two MAX cards */
    .max-grid {
      grid-column: span 2 / span 2;
    }

    /* Responsive tweak: on small screens, MAX cards full width */
    @media (max-width: 768px) {
      .max-grid { grid-column: 1 / -1; }
      .max-price { font-size: 1.75rem; }
    }
  </style>
</head>
<body class="bg-white text-slate-900">

  <!-- Header -->
<header class="sticky top-0 z-40 bg-white/90 backdrop-blur border-b">
  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
    <a href="index.html" class="flex items-center gap-3 text-2xl font-serif text-yellow-800 tracking-wide">
      <img src="assets/img/logo.png" alt="Brand Logo" class="object-contain bg-white rounded-md shadow-md border border-yellow-700 p-1 max-h-24">
      <span class="font-semibold">M/s Onkarnath Agrawal Sarraf (Bachcha Sarraf)</span>
    </a>
    <nav class="hidden md:flex gap-6 text-sm">
      <a href="catalog.html">Catalog</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
    </nav>
  </div>
</header>

<!-- EXTENDED GOLD & SILVER RATES -->
<section class="border-t border-b bg-gradient-to-r from-yellow-50 via-white to-yellow-50 backdrop-blur">
  <div class="max-w-6xl mx-auto px-4 py-12 md:py-16 min-h-[50vh]">
    
    <div class="text-center mb-10">
      <h2 class="text-3xl md:text-5xl font-semibold leading-tight">Today’s Extended Gold & Silver Rates</h2>
      <p class="mt-4 text-slate-600 text-base md:text-lg">
        Bank, Cash, Jewellery & MCX indicative prices — auto-updated from MCX feed.
      </p>
      <div id="rates-updated" class="mt-3 text-sm text-slate-500"></div>
    </div>

    <!-- Rate cards -->
    <div id="extended-rates" class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5"></div>

    <div class="text-xs text-slate-500 text-center mt-6">
      *Gold displayed per <strong>10 g</strong>. Silver displayed per <strong>1 kg</strong>. Values are indicative.
    </div>
  </div>
</section>

<!-- Hero -->
<section class="max-w-6xl mx-auto px-4 py-10 grid md:grid-cols-2 gap-8 items-center">
  <div>
    <h1 class="text-3xl md:text-5xl font-semibold leading-tight">Elegant Gold & Diamond Jewellery</h1>
    <p class="mt-4 text-slate-600">Handcrafted designs. Hallmarked purity. Transparent pricing linked to MCX rates.</p>
    <div class="mt-6 flex gap-3">
      <a href="catalog.html" class="px-5 py-3 rounded-xl bg-black text-white">Shop Catalog</a>
      <a href="contact.html" class="px-5 py-3 rounded-xl border">Book a Visit</a>
    </div>
  </div>
  <img src="assets/img/hero.jpg" class="rounded-2xl w-full object-cover" alt="Hero">
</section>

<!-- New Arrivals (unchanged) -->
<section class="max-w-6xl mx-auto px-4 py-10">
  <h2 class="text-xl font-semibold mb-4">New Arrivals</h2>
  <div id="featured" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
  <div id="featured-empty" class="hidden text-center text-slate-500 py-8">No items to show.</div>
</section>

<!-- Scripts -->
<script>
  // CSV parser (same as before)
  function parseCSV(text) {
    const rows = [];
    let i = 0, cur = '', row = [], inQuotes = false;
    while (i < text.length) {
      const c = text[i];
      if (c === '"') {
        if (inQuotes && text[i+1] === '"') { cur += '"'; i++; }
        else inQuotes = !inQuotes;
      } else if (c === ',' && !inQuotes) { row.push(cur); cur = ''; }
      else if ((c === '\n' || c === '\r') && !inQuotes) {
        if (cur !== '' || row.length) { row.push(cur); rows.push(row); cur=''; row=[]; }
      } else { cur += c; }
      i++;
    }
    if (cur !== '' || row.length) { row.push(cur); rows.push(row); }
    return rows;
  }

  async function loadCSV(url){
    const t = await (await fetch(url, {cache:'no-cache'})).text();
    const parsed = parseCSV(t.trim());
    const head = parsed[0].map(h=>h.trim());
    return parsed.slice(1)
      .filter(r => r && r.length && r.some(cell => (cell||'').trim() !== ''))
      .map(r => Object.fromEntries(head.map((h,i)=>[h, (r[i]||'').trim()])));
  }

  // Products loading (unchanged)
  (async () => {
    try {
      const rows = await loadCSV('data/products.csv');
      const items = rows.map(x => ({
        id: x.id,
        name: x.name,
        category: (x.category||'').toLowerCase(),
        karat: Number(x.karat||0),
        purity: (n=>{ if(n===24) return '24K'; if(n===22) return '22K'; if(n===18) return '18K'; return '';})(Number(x.karat||0)),
        metal: (k,s)=>{ if(Number(k||0)>0) return 'Gold'; if((s||'').toLowerCase()==='diamond') return 'Diamond'; return 'Silver'; }(x.karat, x.stone),
        weight_g: Number(x.weight_g||0),
        image_url: x.image_url || 'assets/img/placeholder.webp',
        description: x.description || ''
      }));

      const featuredEl = document.getElementById('featured');
      const emptyEl = document.getElementById('featured-empty');

      const newest = items
        .sort((a,b) => (Number(b.id||0) - Number(a.id||0)))
        .slice(0, 8);

      if (!newest.length) {
        emptyEl.classList.remove('hidden');
        return;
      }

      featuredEl.innerHTML = newest.map(x => `
        <a href="product.html?id=${encodeURIComponent(x.id)}"
           class="block rounded-2xl border hover:shadow transition overflow-hidden bg-white">
          <img src="${x.image_url}" alt="${x.name}" loading="lazy"
               onerror="this.onerror=null;this.src='assets/img/placeholder.webp';"
               class="w-full aspect-square object-cover" />
          <div class="p-3">
            <h3 class="font-semibold truncate" title="${x.name}">${x.name}</h3>
            <p class="text-sm text-slate-600">
              ${x.metal}${x.purity ? ' ' + x.purity : ''} • ${x.weight_g || 0}g
            </p>
          </div>
        </a>
      `).join('');
    } catch (e) {
      console.warn('Products load failed', e);
    }
  })();

  // Helpers
  function fmtINR(n){
    if (n == null || n === 0 || Number.isNaN(Number(n))) return '–';
    return '₹' + Number(n).toLocaleString('en-IN');
  }
  function prettyUnit(unit) {
    if (!unit) return '';
    const u = unit.trim();
    if (u === '1000 g' || u === '1000g') return '1 kg';
    return u;
  }

  // Put GOLD MAX then SILVER MAX first
  function orderMaxFirst(items) {
    const g = items.filter(i => /GOLD\s*MAX/i.test(i.label));
    const s = items.filter(i => /SILVER\s*MAX/i.test(i.label));
    const rest = items.filter(i => !/GOLD\s*MAX/i.test(i.label) && !/SILVER\s*MAX/i.test(i.label));
    return [...g, ...s, ...rest];
  }

  // Render rates (with special styling for MAX)
  (async () => {
    const grid = document.getElementById('extended-rates');
    const updatedEl = document.getElementById('rates-updated');

    try {
      const resp = await fetch('data/rates.json', { cache: 'no-cache' });
      if (!resp.ok) throw new Error('rates.json fetch failed');
      const d = await resp.json();

      updatedEl.textContent = d.updated ? `Updated ${d.updated} — Source: ${d.source || ''}` : `Source: ${d.source || ''}`;

      if (!Array.isArray(d.items) || d.items.length === 0) {
        grid.innerHTML = `<div class='text-center text-slate-500'>Rates data not available</div>`;
        return;
      }

      // reorder so MAX items are on top
      const items = orderMaxFirst(d.items);

      // Build HTML: for MAX items we give them special class and larger grid span
      const html = items.map(item => {
        const isGoldMax = /GOLD\s*MAX/i.test(item.label || '');
        const isSilverMax = /SILVER\s*MAX/i.test(item.label || '');
        const isMax = isGoldMax || isSilverMax;

        // use unit (10 g for gold, 1000 g for silver). prettyUnit converts 1000 g -> 1 kg
        const unitText = prettyUnit(item.unit || '');

        const buy = (item.buy != null) ? fmtINR(item.buy) : '–';
        const sell = (item.sell != null) ? fmtINR(item.sell) : '–';

        if (isMax) {
          // Make MAX cards visually larger: span 2 columns on md+
          return `
            <div class="relative max-card p-6 ${isGoldMax ? 'max-grid' : 'max-grid'}">
              <div class="max-badge">MCX</div>
              <div class="text-xs uppercase tracking-wide text-slate-500 mb-2">${item.label}</div>
              <div class="font-bold max-price text-yellow-800">${buy}</div>
              <div class="text-sm text-slate-700 mt-1">Sell ${sell}</div>
              <div class="text-xs text-slate-400 mt-3">${unitText}</div>
            </div>
          `;
        } else {
          return `
            <div class="rounded-2xl border p-5 bg-white/80 hover:shadow-lg transition">
              <div class="text-xs uppercase tracking-wide text-slate-500 mb-1">${item.label}</div>
              <div class="text-2xl md:text-3xl font-bold text-slate-800">${buy}</div>
              <div class="text-sm text-slate-600 mt-1">Sell ${sell}</div>
              <div class="text-xs text-slate-400 mt-2">${unitText}</div>
            </div>
          `;
        }
      }).join('');

      grid.innerHTML = html;

    } catch (err) {
      console.error(err);
      grid.innerHTML = `<div class='text-center text-slate-500'>Failed to load rates.</div>`;
      updatedEl.textContent = 'Rates unavailable';
    }
  })();
</script>

</body>
</html>
